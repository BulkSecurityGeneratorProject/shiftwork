(function () {
	'use strict';

	angular
	.module('shiftworkApp')
	.controller('ViewMyScheduleController', ViewMyScheduleController);

	ViewMyScheduleController.$inject = ['$scope', 'ViewMySchedule', 'Employee', 'Typeahead', '$filter', 'calendarConfig', '$state', '$translate'];

	function ViewMyScheduleController($scope, ViewMySchedule, Employee, Typeahead, $filter, calendarConfig, $state, $translate) {
		
		var vm = this;
		
		calendarConfig.templates.calendarMonthCell = 'app/entities/view-my-schedule/calendarMonthCell.html';
		calendarConfig.templates.calendarSlideBox = 'app/entities/view-my-schedule/calendarSlideBox.html';
		calendarConfig.templates.calendarMonthCellEvents = 'app/entities/view-my-schedule/calendarMonthCellEvents.html';

		vm.employees = [];
		vm.loadAll = function () {
			Employee.query(function (result) {
				vm.employees = result;
			});
		};
		vm.loadAll();

		vm.resetFilter = function () {
			vm.loadAll();
			delete vm.currentEmployeeId;
			vm.events = new Array();
		};
		
		vm.getEmployee = function (keyword) {
			if (keyword) {
				return Typeahead.findEmployees(keyword);
			} else {
				vm.resetFilter();
				return [];
			}
		};

		vm.onTypeaheadCallback = function ($item, $model, $label) {
			vm.currentEmployeeId = $item.id;
			vm.loadEmployeeSchedule();
		};

		vm.loadEmployeeSchedule = function () {

			vm.events = new Array();

			var monthRange = vm.getMonthDateRange(vm.viewDate.getFullYear(), vm.viewDate.getMonth());
			var startTimeStamp = monthRange.start.toDate().getTime();
			var endTimeStamp = monthRange.end.toDate().getTime();

			/* vm.employeeSchedule = [{"shiftType":{"id":1046,"code":"D","index":2,"description":"Day shift","nightShift":false,"startTime":"08:30","endTime":"16:30","tasks":null,"endTimeString":"16:30:00","startTimeString":"08:30:00"},"shiftDate":{"id":1048,"dayIndex":14610,"date":"2016-09-01","dayOfWeek":"FRIDAY","dateString":"2016-09-01"},"tasks":[{"id":1031,"code":"T3","description":"Task3","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1001,"code":"001","name":"Employee 001"},{"id":1002,"code":"002","name":"Employee 002"}, {"id":1003,"code":"003","name":"Employee 003"}]},{"id":1032,"code":"T4","description":"Task4","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Not_Urgent","coworkers":[{"id":1001,"code":"001","name":"Employee 001"},{"id":1002,"code":"002","name":"Employee 002"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1060,"dayIndex":14611,"date":"2016-09-01","dayOfWeek":"SATURDAY","dateString":"2016-09-01"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1002,"code":"002","name":"Employee 002"},{"id":1003,"code":"003","name":"Employee 003"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1002,"code":"002","name":"Employee 002"},{"id":1003,"code":"003","name":"Employee 003"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":true,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1072,"dayIndex":14612,"date":"2016-09-03","dayOfWeek":"SUNDAY","dateString":"2016-09-03"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1003,"code":"003","name":"Employee 003"},{"id":1004,"code":"004","name":"Employee 004"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1003,"code":"003","name":"Employee 003"},{"id":1004,"code":"004","name":"Employee 004"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1084,"dayIndex":14613,"date":"2016-09-04","dayOfWeek":"MONDAY","dateString":"2016-09-04"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1004,"code":"004","name":"Employee 004"},{"id":1005,"code":"005","name":"Employee 005"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1004,"code":"004","name":"Employee 004"},{"id":1005,"code":"005","name":"Employee 005"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1096,"dayIndex":14614,"date":"2016-09-05","dayOfWeek":"TUESDAY","dateString":"2016-09-05"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1005,"code":"005","name":"Employee 005"},{"id":1006,"code":"006","name":"Employee 006"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1005,"code":"005","name":"Employee 005"},{"id":1006,"code":"006","name":"Employee 006"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1132,"dayIndex":14617,"date":"2016-09-08","dayOfWeek":"FRIDAY","dateString":"2016-09-08"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1006,"code":"006","name":"Employee 006"},{"id":1007,"code":"007","name":"Employee 007"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1006,"code":"006","name":"Employee 006"},{"id":1007,"code":"007","name":"Employee 007"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1144,"dayIndex":14618,"date":"2016-09-09","dayOfWeek":"SATURDAY","dateString":"2016-09-09"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1007,"code":"007","name":"Employee 007"},{"id":1008,"code":"008","name":"Employee 008"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1007,"code":"007","name":"Employee 007"},{"id":1008,"code":"008","name":"Employee 008"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1156,"dayIndex":14619,"date":"2016-09-10","dayOfWeek":"SUNDAY","dateString":"2016-09-10"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1008,"code":"008","name":"Employee 008"},{"id":1009,"code":"009","name":"Employee 009"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1008,"code":"008","name":"Employee 008"},{"id":1009,"code":"009","name":"Employee 009"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1168,"dayIndex":14620,"date":"2016-09-11","dayOfWeek":"MONDAY","dateString":"2016-09-11"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1009,"code":"009","name":"Employee 009"},{"id":1010,"code":"0010","name":"Employee 0010"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1009,"code":"009","name":"Employee 009"},{"id":1010,"code":"0010","name":"Employee 0010"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1180,"dayIndex":14621,"date":"2016-09-12","dayOfWeek":"TUESDAY","dateString":"2016-09-12"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1010,"code":"0010","name":"Employee 0010"},{"id":1011,"code":"0011","name":"Employee 0011"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1010,"code":"0010","name":"Employee 0010"},{"id":1011,"code":"0011","name":"Employee 0011"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1192,"dayIndex":14622,"date":"2016-09-13","dayOfWeek":"WEDNESDAY","dateString":"2016-09-13"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1011,"code":"0011","name":"Employee 0011"},{"id":1012,"code":"0012","name":"Employee 0012"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1011,"code":"0011","name":"Employee 0011"},{"id":1012,"code":"0012","name":"Employee 0012"}]}]},{"shiftType":{"id":1046,"code":"D","index":2,"description":"Day shift","nightShift":false,"startTime":"08:30","endTime":"16:30","tasks":null,"endTimeString":"16:30:00","startTimeString":"08:30:00"},"shiftDate":{"id":1216,"dayIndex":14624,"date":"2016-09-15","dayOfWeek":"FRIDAY","dateString":"2016-09-15"},"tasks":[{"id":1031,"code":"T3","description":"Task3","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1012,"code":"0012","name":"Employee 0012"},{"id":1013,"code":"0013","name":"Employee 0013"}]},{"id":1032,"code":"T4","description":"Task4","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Not_Urgent","coworkers":[{"id":1012,"code":"0012","name":"Employee 0012"},{"id":1013,"code":"0013","name":"Employee 0013"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1228,"dayIndex":14625,"date":"2016-09-16","dayOfWeek":"SATURDAY","dateString":"2016-09-16"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1013,"code":"0013","name":"Employee 0013"},{"id":1014,"code":"0014","name":"Employee 0014"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1013,"code":"0013","name":"Employee 0013"},{"id":1014,"code":"0014","name":"Employee 0014"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1240,"dayIndex":14626,"date":"2016-09-17","dayOfWeek":"SUNDAY","dateString":"2016-09-17"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1014,"code":"0014","name":"Employee 0014"},{"id":1015,"code":"0015","name":"Employee 0015"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1014,"code":"0014","name":"Employee 0014"},{"id":1015,"code":"0015","name":"Employee 0015"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1252,"dayIndex":14627,"date":"2016-09-18","dayOfWeek":"MONDAY","dateString":"2016-09-18"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1015,"code":"0015","name":"Employee 0015"},{"id":1016,"code":"0016","name":"Employee 0016"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1015,"code":"0015","name":"Employee 0015"},{"id":1016,"code":"0016","name":"Employee 0016"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1288,"dayIndex":14630,"date":"2016-09-21","dayOfWeek":"THURSDAY","dateString":"2016-09-21"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1016,"code":"0016","name":"Employee 0016"},{"id":1017,"code":"0017","name":"Employee 0017"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1016,"code":"0016","name":"Employee 0016"},{"id":1017,"code":"0017","name":"Employee 0017"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1300,"dayIndex":14631,"date":"2016-09-22","dayOfWeek":"FRIDAY","dateString":"2016-09-22"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1017,"code":"0017","name":"Employee 0017"},{"id":1018,"code":"0018","name":"Employee 0018"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1017,"code":"0017","name":"Employee 0017"},{"id":1018,"code":"0018","name":"Employee 0018"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1312,"dayIndex":14632,"date":"2016-09-23","dayOfWeek":"SATURDAY","dateString":"2016-09-23"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1018,"code":"0018","name":"Employee 0018"},{"id":1019,"code":"0019","name":"Employee 0019"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1018,"code":"0018","name":"Employee 0018"},{"id":1019,"code":"0019","name":"Employee 0019"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1324,"dayIndex":14633,"date":"2016-09-24","dayOfWeek":"SUNDAY","dateString":"2016-09-24"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1019,"code":"0019","name":"Employee 0019"},{"id":1020,"code":"0020","name":"Employee 0020"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1019,"code":"0019","name":"Employee 0019"},{"id":1020,"code":"0020","name":"Employee 0020"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1336,"dayIndex":14634,"date":"2016-09-25","dayOfWeek":"MONDAY","dateString":"2016-09-25"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1020,"code":"0020","name":"Employee 0020"},{"id":1021,"code":"0021","name":"Employee 0021"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1020,"code":"0020","name":"Employee 0020"},{"id":1021,"code":"0021","name":"Employee 0021"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1348,"dayIndex":14635,"date":"2016-09-26","dayOfWeek":"TUESDAY","dateString":"2016-09-26"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1021,"code":"0021","name":"Employee 0021"},{"id":1022,"code":"0022","name":"Employee 0022"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1021,"code":"0021","name":"Employee 0021"},{"id":1022,"code":"0022","name":"Employee 0022"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1360,"dayIndex":14636,"date":"2016-09-27","dayOfWeek":"WEDNESDAY","dateString":"2016-09-27"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1022,"code":"0022","name":"Employee 0022"},{"id":1023,"code":"0023","name":"Employee 0023"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1022,"code":"0022","name":"Employee 0022"},{"id":1023,"code":"0023","name":"Employee 0023"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1372,"dayIndex":14637,"date":"2016-09-28","dayOfWeek":"THURSDAY","dateString":"2016-09-28"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1023,"code":"0023","name":"Employee 0023"},{"id":1024,"code":"0024","name":"Employee 0024"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1023,"code":"0023","name":"Employee 0023"},{"id":1024,"code":"0024","name":"Employee 0024"}]}]},  {"shiftType":{"id":1046,"code":"D","index":2,"description":"Day shift","nightShift":false,"startTime":"08:30","endTime":"16:30","tasks":null,"endTimeString":"16:30:00","startTimeString":"08:30:00"},"shiftDate":{"id":1048,"dayIndex":14610,"date":"2016-10-01","dayOfWeek":"FRIDAY","dateString":"2016-10-01"},"tasks":[{"id":1031,"code":"T3","description":"Task3","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1001,"code":"001","name":"Employee 001"},{"id":1002,"code":"002","name":"Employee 002"}]},{"id":1032,"code":"T4","description":"Task4","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Not_Urgent","coworkers":[{"id":1001,"code":"001","name":"Employee 001"},{"id":1002,"code":"002","name":"Employee 002"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1060,"dayIndex":14611,"date":"2016-10-01","dayOfWeek":"SATURDAY","dateString":"2016-10-01"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1002,"code":"002","name":"Employee 002"},{"id":1003,"code":"003","name":"Employee 003"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1002,"code":"002","name":"Employee 002"},{"id":1003,"code":"003","name":"Employee 003"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":true,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1072,"dayIndex":14612,"date":"2016-10-03","dayOfWeek":"SUNDAY","dateString":"2016-10-03"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1003,"code":"003","name":"Employee 003"},{"id":1004,"code":"004","name":"Employee 004"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1003,"code":"003","name":"Employee 003"},{"id":1004,"code":"004","name":"Employee 004"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1084,"dayIndex":14613,"date":"2016-10-04","dayOfWeek":"MONDAY","dateString":"2016-10-04"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1004,"code":"004","name":"Employee 004"},{"id":1005,"code":"005","name":"Employee 005"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1004,"code":"004","name":"Employee 004"},{"id":1005,"code":"005","name":"Employee 005"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1096,"dayIndex":14614,"date":"2016-10-05","dayOfWeek":"TUESDAY","dateString":"2016-10-05"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1005,"code":"005","name":"Employee 005"},{"id":1006,"code":"006","name":"Employee 006"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1005,"code":"005","name":"Employee 005"},{"id":1006,"code":"006","name":"Employee 006"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1132,"dayIndex":14617,"date":"2016-10-08","dayOfWeek":"FRIDAY","dateString":"2016-10-08"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1006,"code":"006","name":"Employee 006"},{"id":1007,"code":"007","name":"Employee 007"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1006,"code":"006","name":"Employee 006"},{"id":1007,"code":"007","name":"Employee 007"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1144,"dayIndex":14618,"date":"2016-10-09","dayOfWeek":"SATURDAY","dateString":"2016-10-09"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1007,"code":"007","name":"Employee 007"},{"id":1008,"code":"008","name":"Employee 008"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1007,"code":"007","name":"Employee 007"},{"id":1008,"code":"008","name":"Employee 008"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1156,"dayIndex":14619,"date":"2016-10-10","dayOfWeek":"SUNDAY","dateString":"2016-10-10"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1008,"code":"008","name":"Employee 008"},{"id":1009,"code":"009","name":"Employee 009"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1008,"code":"008","name":"Employee 008"},{"id":1009,"code":"009","name":"Employee 009"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1168,"dayIndex":14620,"date":"2016-10-11","dayOfWeek":"MONDAY","dateString":"2016-10-11"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1009,"code":"009","name":"Employee 009"},{"id":1010,"code":"0010","name":"Employee 0010"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1009,"code":"009","name":"Employee 009"},{"id":1010,"code":"0010","name":"Employee 0010"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1180,"dayIndex":14621,"date":"2016-10-12","dayOfWeek":"TUESDAY","dateString":"2016-10-12"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1010,"code":"0010","name":"Employee 0010"},{"id":1011,"code":"0011","name":"Employee 0011"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1010,"code":"0010","name":"Employee 0010"},{"id":1011,"code":"0011","name":"Employee 0011"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1192,"dayIndex":14622,"date":"2016-10-13","dayOfWeek":"WEDNESDAY","dateString":"2016-10-13"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1011,"code":"0011","name":"Employee 0011"},{"id":1012,"code":"0012","name":"Employee 0012"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1011,"code":"0011","name":"Employee 0011"},{"id":1012,"code":"0012","name":"Employee 0012"}]}]},{"shiftType":{"id":1046,"code":"D","index":2,"description":"Day shift","nightShift":false,"startTime":"08:30","endTime":"16:30","tasks":null,"endTimeString":"16:30:00","startTimeString":"08:30:00"},"shiftDate":{"id":1216,"dayIndex":14624,"date":"2016-10-15","dayOfWeek":"FRIDAY","dateString":"2016-10-15"},"tasks":[{"id":1031,"code":"T3","description":"Task3","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1012,"code":"0012","name":"Employee 0012"},{"id":1013,"code":"0013","name":"Employee 0013"}]},{"id":1032,"code":"T4","description":"Task4","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Not_Urgent","coworkers":[{"id":1012,"code":"0012","name":"Employee 0012"},{"id":1013,"code":"0013","name":"Employee 0013"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1228,"dayIndex":14625,"date":"2016-10-16","dayOfWeek":"SATURDAY","dateString":"2016-10-16"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1013,"code":"0013","name":"Employee 0013"},{"id":1014,"code":"0014","name":"Employee 0014"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1013,"code":"0013","name":"Employee 0013"},{"id":1014,"code":"0014","name":"Employee 0014"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1240,"dayIndex":14626,"date":"2016-10-17","dayOfWeek":"SUNDAY","dateString":"2016-10-17"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1014,"code":"0014","name":"Employee 0014"},{"id":1015,"code":"0015","name":"Employee 0015"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1014,"code":"0014","name":"Employee 0014"},{"id":1015,"code":"0015","name":"Employee 0015"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1252,"dayIndex":14627,"date":"2016-10-18","dayOfWeek":"MONDAY","dateString":"2016-10-18"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1015,"code":"0015","name":"Employee 0015"},{"id":1016,"code":"0016","name":"Employee 0016"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1015,"code":"0015","name":"Employee 0015"},{"id":1016,"code":"0016","name":"Employee 0016"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1288,"dayIndex":14630,"date":"2016-10-21","dayOfWeek":"THURSDAY","dateString":"2016-10-21"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1016,"code":"0016","name":"Employee 0016"},{"id":1017,"code":"0017","name":"Employee 0017"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1016,"code":"0016","name":"Employee 0016"},{"id":1017,"code":"0017","name":"Employee 0017"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1300,"dayIndex":14631,"date":"2016-10-22","dayOfWeek":"FRIDAY","dateString":"2016-10-22"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1017,"code":"0017","name":"Employee 0017"},{"id":1018,"code":"0018","name":"Employee 0018"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1017,"code":"0017","name":"Employee 0017"},{"id":1018,"code":"0018","name":"Employee 0018"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1312,"dayIndex":14632,"date":"2016-10-23","dayOfWeek":"SATURDAY","dateString":"2016-10-23"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1018,"code":"0018","name":"Employee 0018"},{"id":1019,"code":"0019","name":"Employee 0019"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1018,"code":"0018","name":"Employee 0018"},{"id":1019,"code":"0019","name":"Employee 0019"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1324,"dayIndex":14633,"date":"2016-10-24","dayOfWeek":"SUNDAY","dateString":"2016-10-24"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1019,"code":"0019","name":"Employee 0019"},{"id":1020,"code":"0020","name":"Employee 0020"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1019,"code":"0019","name":"Employee 0019"},{"id":1020,"code":"0020","name":"Employee 0020"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1336,"dayIndex":14634,"date":"2016-10-25","dayOfWeek":"MONDAY","dateString":"2016-10-25"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1020,"code":"0020","name":"Employee 0020"},{"id":1021,"code":"0021","name":"Employee 0021"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1020,"code":"0020","name":"Employee 0020"},{"id":1021,"code":"0021","name":"Employee 0021"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1348,"dayIndex":14635,"date":"2016-10-26","dayOfWeek":"TUESDAY","dateString":"2016-10-26"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1021,"code":"0021","name":"Employee 0021"},{"id":1022,"code":"0022","name":"Employee 0022"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1021,"code":"0021","name":"Employee 0021"},{"id":1022,"code":"0022","name":"Employee 0022"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1360,"dayIndex":14636,"date":"2016-10-27","dayOfWeek":"WEDNESDAY","dateString":"2016-10-27"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1022,"code":"0022","name":"Employee 0022"},{"id":1023,"code":"0023","name":"Employee 0023"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1022,"code":"0022","name":"Employee 0022"},{"id":1023,"code":"0023","name":"Employee 0023"}]}]},{"shiftType":{"id":1044,"code":"E","index":0,"description":"Early","nightShift":false,"startTime":"06:30","endTime":"14:30","tasks":null,"endTimeString":"14:30:00","startTimeString":"06:30:00"},"shiftDate":{"id":1372,"dayIndex":14637,"date":"2016-10-28","dayOfWeek":"THURSDAY","dateString":"2016-10-28"},"tasks":[{"id":1029,"code":"T1","description":"Task1","staffNeeded":1,"taskType":"SHORT","importance":"Not_Important","urgency":"Urgent","coworkers":[{"id":1023,"code":"0023","name":"Employee 0023"},{"id":1024,"code":"0024","name":"Employee 0024"}]},{"id":1030,"code":"T2","description":"Task2","staffNeeded":1,"taskType":"MAIN","importance":"Important","urgency":"Urgent","coworkers":[{"id":1023,"code":"0023","name":"Employee 0023"},{"id":1024,"code":"0024","name":"Employee 0024"}]}]}];
			vm.formatEmployeeSchedule(); */
			ViewMySchedule.query({
				employee : vm.currentEmployeeId,
				fromDate : startTimeStamp,
				toDate : endTimeStamp
			},
			function (result) {
				vm.employeeSchedule = result;
				vm.formatEmployeeSchedule();
			});
		};

		vm.formatEmployeeSchedule = function () {

			for (var index = 0; index < vm.employeeSchedule.length; index++) {

				var empTasks = vm.employeeSchedule[index].tasks;
				var shiftDate = vm.employeeSchedule[index].shiftDate;
				var shiftType = vm.employeeSchedule[index].shiftType;
				
				var shiftDescription = $translate.instant("shiftworkApp.viewMySchedule.shiftDescription")
				.replace("##_DATE_##", new moment(new Date(shiftDate.date)).format('MMMM DD'))
				.replace("##_SHIFT_TYPE_##", shiftType.description);

				var taskDescription = "";
				
				for (var taskIndex = 0; taskIndex < empTasks.length; taskIndex++) {

					taskDescription += "<li class='taskDescription'><strong>" + empTasks[taskIndex].description + "</strong>";
					
					if(empTasks[taskIndex].coworkers.length > 0) {
						
						var coworkers = empTasks[taskIndex].coworkers.map(function(coworker){return coworker.name});
					
						if(coworkers.length > 1) {
							coworkers = coworkers.join(",");
							var lastCommaIndex = coworkers.lastIndexOf(",");
							coworkers = coworkers.substr(0, lastCommaIndex) + " & " + coworkers.substr(lastCommaIndex + 1);
						}
						else {
							coworkers = coworkers.join("");
						}
							
						taskDescription += ", " + $translate.instant("shiftworkApp.viewMySchedule.taskDescription")
						.replace("##_CO_WORKERS_##", coworkers);
					
					}
					
					taskDescription += "</li>";
						
				}
				
				shiftDescription += taskDescription;
				
				vm.events.push({
					$id : index + 1,
					title : shiftDescription,
					startsAt : new Date(shiftDate.date),
					endsAt : new Date(shiftDate.date),
					color : calendarConfig.colorTypes.info,
					data : {
						empShift : vm.employeeSchedule[index]
					},
					cssClass : "shiftDescription"
				});
				
			}

		};

		vm.calendarView = 'month';
		vm.viewDate = new Date();
		vm.isCellOpen = true;

		vm.toggle = function ($event, field, event) {
			$event.preventDefault();
			$event.stopPropagation();
			event[field] = !event[field];
		};

		vm.viewDateChanged = function () {
			//console.log("viewDateChanged", vm.viewDate);
			vm.loadEmployeeSchedule();
		};

		vm.getMonthDateRange = function (year, month) {
			var startDate = moment([year, month]);
			var endDate = moment(startDate).endOf('month');
			
			// make sure to call toDate() for plain JavaScript date type
			return {
				start : startDate,
				end : endDate
			};
		};
		
		vm.cellModifier = function (cell) {
			if(cell.events && cell.events.length > 0) {
				var empShift = cell.events[0].data.empShift;
				var isNightShift = empShift.shiftType.nightShift;
				
				cell.cssClass = isNightShift ? 'night-shift' : 'day-shift';
			}
		};
		
		$scope.$on('$destroy', function() {
			calendarConfig.templates.calendarMonthCell = 'mwl/calendarMonthCell.html';
			calendarConfig.templates.calendarSlideBox = 'mwl/calendarSlideBox.html';
			calendarConfig.templates.calendarMonthCellEvents = 'mwl/calendarMonthCellEvents.html';
		});
	}
})();